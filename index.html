<!DOCTYPE html>
<html lang="my">
<head>
  <meta charset="UTF-8" />
  <title>Chucky AI + StarryAI Image</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    *{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:sans-serif;display:flex;flex-direction:column;height:100vh;background:#f0f0f0;}
    header{background:#10a37f;color:#fff;text-align:center;padding:1rem;font-size:1.2rem;}
    #chat{flex:1;overflow-y:auto;padding:1rem;display:flex;flex-direction:column;gap:.5rem;}
    .msg{max-width:80%;padding:.75rem 1rem;border-radius:1rem;white-space:pre-wrap;}
    .user{align-self:flex-end;background:#10a37f;color:#fff;border-bottom-right-radius:0;}
    .bot{align-self:flex-start;background:#e5e5ea;color:#111;border-bottom-left-radius:0;}
    img{max-width:100%;border-radius:.75rem;margin-top:.5rem;}
    form{display:flex;gap:.5rem;padding:.75rem;background:#fff;border-top:1px solid #ddd;}
    input{flex:1;padding:.75rem 1rem;border:1px solid #ccc;border-radius:2rem;font-size:1rem;}
    button{padding:0 1rem;font-size:1.3rem;border:none;border-radius:50%;cursor:pointer;background:#10a37f;color:#fff;}
    #mic{background:#eee;color:#10a37f;}
  </style>
</head>
<body>
  <header>ðŸ¤– Chucky AI + StarryAI</header>
  <div id="chat"></div>
  <form id="form">
    <input id="input" placeholder="Type message or 'á€•á€¯á€¶á€†á€½á€²á€•á€«'..." />
    <button type="button" id="mic">ðŸŽ¤</button>
    <button type="submit">âž¤</button>
  </form>

<script>
const chat = document.getElementById('chat'),
      input = document.getElementById('input'),
      form = document.getElementById('form');

const GROQ_KEY = 'Bearer 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';
const STARRY_KEY = 'sk-dk6Cde3n12dW3Ie8UHDAmJo3OVRDQ2EnDTG7E3JpzM7o45m0'; // header: X-API-Key

function addMsg(sender, content, isImage=false){
  const div = document.createElement('div');
  div.className = `msg ${sender==='You'?'user':'bot'}`;
  if(isImage){
    const img = document.createElement('img'); img.src = content; div.appendChild(img);
  } else {
    div.textContent = content;
  }
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function saveHist(sender, content, isImage=false){
  const h = JSON.parse(localStorage.getItem('hist')||'[]');
  h.push({sender,content,isImage}); localStorage.setItem('hist',JSON.stringify(h));
}

function loadHist(){
  (JSON.parse(localStorage.getItem('hist')||'[]')).forEach(m=>addMsg(m.sender,m.content,m.isImage));
}

function speak(text){
  const u = new SpeechSynthesisUtterance(text);
  u.lang='my-MM'; speechSynthesis.speak(u);
}

async function imageGen(prompt){
  try{
    const r=await fetch('https://api.starryai.com/creations', {
      method:'POST',
      headers:{
        'Content-Type':'application/json',
        'X-API-Key':STARRY_KEY
      },
      body: JSON.stringify({prompt})
    });
    const j=await r.json();
    return j.image_url || null;
  } catch { return null; }
}

async function groqChat(prompt){
  try{
    const r=await fetch('https://api.groq.com/openai/v1/chat/completions',{
      method:'POST',
      headers:{'Content-Type':'application/json','Authorization':GROQ_KEY},
      body: JSON.stringify({
        model:'llama3-8b-8192',
        messages:[
          {role:'system',content:'You are Chucky, Burmese assistant. No apologies.'},
          {role:'user',content:prompt}
        ]
      })
    });
    const j=await r.json().catch(()=>null);
    return j?.choices?.[0]?.message?.content || null;
  } catch { return null; }
}

async function onUser(text){
  addMsg('You',text); saveHist('You',text);
  const t=text.toLowerCase();
  const nameQs=['á€”á€¬á€™á€Šá€º','name'];
  if(nameQs.some(w=>t.includes(w))){
    const r='á€€á€»á€½á€”á€ºá€á€±á€¬á€·á€ºá€”á€¬á€™á€Šá€º Chucky á€•á€«á‹ á€™á€°á€›á€„á€ºá€¸ Groq AI á€–á€¼á€…á€ºá€•á€¼á€®á€¸ Dev Htet Nyan Soe á€–á€”á€ºá€á€®á€¸á€á€²á€·á€•á€«á€žá€Šá€ºá‹';
    addMsg('Chucky',r); speak(r); saveHist('Chucky',r);
    return;
  }
  if(t.includes('á€•á€¯á€¶á€†á€½á€²')){
    addMsg('Chucky','á€•á€¯á€¶á€†á€½á€²á€”á€±á€•á€«á€žá€Šá€º...'); saveHist('Chucky','...pending');
    const img = await imageGen(text);
    if(img){
      addMsg('Chucky',img,true); speak('á€•á€¯á€¶á€–á€”á€ºá€á€®á€¸á€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹'); saveHist('Chucky',img,true);
    } else {
      addMsg('Chucky','á€•á€¯á€¶á€™á€‘á€½á€€á€ºá€•á€«á‹ á€‘á€•á€ºá€€á€¼á€­á€¯á€¸á€…á€¬á€¸á€•á€«á‹'); saveHist('Chucky','error');
    }
    return;
  }
  addMsg('Chucky','Thinking...'); saveHist('Chucky','Thinking...');
  const resp=await groqChat(text);
  if(resp){
    addMsg('Chucky',resp); speak(resp); saveHist('Chucky',resp);
  } else {
    addMsg('Chucky','á€™á€–á€¼á€±á€”á€­á€¯á€„á€ºá€á€¬ á€á€±á€¬á€„á€ºá€¸á€•á€”á€ºá€•á€«á€á€šá€ºá‹');
  }
}

form.addEventListener('submit',e=>{
  e.preventDefault(); const v=input.value.trim(); if(v) onUser(v); input.value='';
});

document.getElementById('mic').addEventListener('click',()=>{
  const r=new (window.SpeechRecognition||window.webkitSpeechRecognition)();
  r.lang='my-MM'; r.start();
  r.onresult=e=> input.value = e.results[0][0].transcript;
});

loadHist();

</script>
</body></html>
